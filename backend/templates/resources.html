{% extends "base.html" %}

{% block title %}Resources - Pace Web App{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>Resources</h1>
        <p>Helpful links and documentation for your projects</p>
        <button class="btn btn-primary" onclick="openAddResourceModal()">Add New Resource</button>
    </div>
</div>

<div class="container">
    <div class="resources-filters">
        <button class="filter-btn active" onclick="filterResources('all')">All</button>
        <button class="filter-btn" onclick="filterResources('Documentation')">Documentation</button>
        <button class="filter-btn" onclick="filterResources('Tutorial')">Tutorial</button>
        <button class="filter-btn" onclick="filterResources('Reference')">Reference</button>
    </div>

    <div class="resources-container">
        <div class="resources-grid" id="resources-grid">
            <div class="loading">Loading resources...</div>
        </div>
    </div>
</div>

<!-- Add Resource Modal -->
<div id="addResourceModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Add New Resource</h2>
            <span class="close" onclick="closeAddResourceModal()">&times;</span>
        </div>
        <form id="addResourceForm">
            <div class="form-group">
                <label for="resourceTitle">Title:</label>
                <input type="text" id="resourceTitle" name="title" required>
            </div>
            <div class="form-group">
                <label for="resourceUrl">URL:</label>
                <input type="url" id="resourceUrl" name="url" required>
            </div>
            <div class="form-group">
                <label for="resourceCategory">Category:</label>
                <select id="resourceCategory" name="category" required>
                    <option value="">Select a category</option>
                    <option value="Documentation">Documentation</option>
                    <option value="Tutorial">Tutorial</option>
                    <option value="Reference">Reference</option>
                    <option value="Tools">Tools</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            <div class="form-group">
                <label for="resourceDescription">Description:</label>
                <textarea id="resourceDescription" name="description" rows="3"></textarea>
            </div>
            <div class="form-actions">
                <button type="button" class="btn btn-secondary" onclick="closeAddResourceModal()">Cancel</button>
                <button type="submit" class="btn btn-primary">Add Resource</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    let resourcesData = [];
    let currentFilter = 'all';

    document.addEventListener('DOMContentLoaded', function() {
        loadResources();
    });

    async function loadResources() {
        try {
            const response = await fetch('/api/resources');
            const data = await response.json();
            
            if (data.status === 'success') {
                resourcesData = data.data;
                renderResources();
            } else {
                throw new Error('Failed to load resources');
            }
        } catch (error) {
            console.error('Error loading resources:', error);
            document.getElementById('resources-grid').innerHTML = '<div class="error">Error loading resources</div>';
        }
    }

    function renderResources() {
        const resourcesGrid = document.getElementById('resources-grid');
        
        let filteredResources = resourcesData;
        if (currentFilter !== 'all') {
            filteredResources = resourcesData.filter(resource => resource.category === currentFilter);
        }

        if (filteredResources.length === 0) {
            resourcesGrid.innerHTML = '<div class="empty-state">No resources found. Add your first resource!</div>';
            return;
        }

        const resourcesHTML = filteredResources.map(resource => `
            <div class="resource-card">
                <div class="resource-header">
                    <h3><a href="${resource.url}" target="_blank" rel="noopener noreferrer">${resource.title}</a></h3>
                    <span class="resource-category">${resource.category}</span>
                </div>
                <div class="resource-content">
                    <p>${resource.description || 'No description available'}</p>
                    <div class="resource-actions">
                        <a href="${resource.url}" target="_blank" rel="noopener noreferrer" class="btn btn-small">Visit Link</a>
                    </div>
                </div>
            </div>
        `).join('');

        resourcesGrid.innerHTML = resourcesHTML;
    }

    function filterResources(category) {
        currentFilter = category;
        
        // Update active filter button
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');
        
        renderResources();
    }

    function openAddResourceModal() {
        document.getElementById('addResourceModal').style.display = 'block';
    }

    function closeAddResourceModal() {
        document.getElementById('addResourceModal').style.display = 'none';
        document.getElementById('addResourceForm').reset();
    }

    document.getElementById('addResourceForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(e.target);
        const resourceItem = {
            title: formData.get('title'),
            url: formData.get('url'),
            category: formData.get('category'),
            description: formData.get('description')
        };

        try {
            const response = await fetch('/api/resources', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(resourceItem)
            });

            const data = await response.json();
            
            if (data.status === 'success') {
                closeAddResourceModal();
                loadResources(); // Reload the resources
                showNotification('Resource added successfully!', 'success');
            } else {
                throw new Error(data.message || 'Failed to add resource');
            }
        } catch (error) {
            console.error('Error adding resource:', error);
            showNotification('Error adding resource: ' + error.message, 'error');
        }
    });

    // Close modal when clicking outside of it
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('addResourceModal');
        if (event.target === modal) {
            closeAddResourceModal();
        }
    });
</script>
{% endblock %}